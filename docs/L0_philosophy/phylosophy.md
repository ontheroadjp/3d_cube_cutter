# PHILOSOPHY (AI-First / MUST Rules)

本ドキュメントは、本プロジェクトにおける **唯一の思想的な前提（Single Source of Truth）** を定義する。
特に **AI駆動開発** において、AIエージェントが作業を開始する前に「何を正とし、何を目的とするか」を誤解なく理解するための土台として機能する。

**本ドキュメントに反する実装・判断・提案は、原則として採用しない。**

---

# 0. 本プロジェクトの本質的価値（WHY）

## 0.1 必須理解
- AIエージェントは、本プロジェクトを **「立体切断シミュレーター」ではなく学習支援アプリケーション**として扱わなければならない。
- 3D表示は目的ではなく、**理解を促すための手段**である。

## 0.2 目標（学習到達点）
本プロジェクトは、学習者が以下を達成できる状態を支援する。

- 切断面の形を正しく捉えられる
- 切断後の立体の構成を理解できる
- 面積・体積などの求積問題に答えられる

## 0.3 非目標
- 「かっこいい3D表示」を第一目的にしてはならない（MUST NOT）。
- 「とりあえず動く」を最優先して内部整合性を捨ててはならない（MUST NOT）。

---

# 1. 構造主導アーキテクチャー（HOW）

## 1.1 定義
構造主導アーキテクチャーとは、立体図形の操作（切断点指定、切断、展開など）を行う際に、
座標系（x, y, z）に依存した計算を中心に据えず、**立体図形自身が保持する構造情報**に基づいて処理する設計である。

構造情報とは少なくとも以下を含む。

- 頂点（Vertex）・辺（Edge）・面（Face）の集合
- 接続関係（どの面がどの辺を共有するか等）
- 要素の状態（所属、パラメータ、フラグなど）

---

## 1.2 最重要ルール（Single Source of Truth）
### MUST
- **構造情報を唯一の正として扱わなければならない（MUST）。**
- 座標（x, y, z）は **描画・表示のために生成される派生情報** として扱わなければならない（MUST）。
- 立体の正しさ・一貫性は **構造情報によって担保**しなければならない（MUST）。

### MUST NOT
- 座標を唯一の正として扱ってはならない（MUST NOT）。
- 「座標から構造を後付け復元する設計」を採用してはならない（MUST NOT）。

---

## 1.3 座標主導のアンチパターン
座標主導アーキテクチャーは、浮動小数点誤差により以下の問題を引き起こし得る。

- 本来同一点である交点が微小にずれ、別点として扱われる
- 「辺上にあるはずの点」が辺上判定に失敗する
- 切断線や面の整合性が崩れ、形状が破綻する

AIエージェントは、これらの問題を **epsilon（誤差許容）による帳尻合わせ**で解決してはならない（MUST NOT）。

---

# 2. 実装判断の優先順位（Decision Order）

AIエージェントは、実装判断を必ず以下の優先順位で行わなければならない（MUST）。

1. **構造整合性が保たれること（Consistency）**
2. **構造的に一意に確定できること（Determinism）**
3. **機能追加・問題追加が容易であること（Extensibility）**
4. **座標計算への依存を最小化すること（Non-coordinate-centric）**
5. **描画・見た目の最適化は最後に行うこと（Derived Rendering）**

---

# 3. AIエージェント行動規範（Operating Rules for AI）

## 3.1 作業開始前の必須確認（MUST）
AIエージェントは作業開始前に、必ず以下を明確化しなければならない。

- 今回の変更が「学習価値（理解・求積）」にどう寄与するか
- 今回の変更で「構造情報として何を保持するか」
- 座標計算を導入する場合、その座標が **派生情報** であることを示すか

## 3.2 期待される設計態度（MUST）
- 操作（切断・展開）を **構造上の状態遷移**として定義しなければならない（MUST）。
- UI/描画は **構造の結果**として生成されるものとして扱わなければならない（MUST）。
- 将来的な学習モード・解説・問題追加を阻害する設計を採用してはならない（MUST NOT）。

---

# 4. 禁止事項（MUST NOT List）

AIエージェントは以下を行ってはならない。

- epsilon 前提の近似判定で整合性を維持する
- 「見た目が合うからOK」として内部整合性を捨てる
- 面・辺・頂点の関係が曖昧な状態で処理を進める
- 座標計算の寄せ集めで切断・展開を成立させる
- 学習価値より実装都合・見た目都合を優先する

---

# 5. 期待される成果（Outcomes）

この思想に従うことで、以下を得る。

- 浮動小数点誤差による破綻を回避しやすい
- 切断・展開・再構築でも整合性を維持しやすい
- 問題追加や学習機能追加が構造の拡張として自然に行える
- 表示（座標）と意味（構造）を分離でき、保守性が向上する
- 学習者が「理解し、解答できる」体験に直結する

---

# 6. 本ドキュメントの位置づけ（Authority）

- 本ドキュメントは設計・実装の判断基準であり、常に最優先される（MUST）。
- AIエージェントは作業開始前に本ドキュメントを前提として読み込む（MUST）。
- 判断に迷った場合は「構造が正」「学習価値が中心」に立ち返る（MUST）。
