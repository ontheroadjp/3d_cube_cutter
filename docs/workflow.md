## 1. はじめに

このリポジトリのワークフローの前提となる

- ドキュメント構造
- GitHub 操作
- コード規約

について説明します。

### ドキュメント

- このリポジトリは構造化されたドキュメント運用を採用しています。
- このリポジトリに関するドキュメントは全て `docs/` に配置されています。
- ドキュメントは L0 と L1 の2つのレイヤーを持ちます。
- L0, L1 はそれぞれ、`docs/L0_philosophy`, `docs/L1_specification` ディレクトリに対応します。
- L0 には本プロジェクトを構築する上での思想・コンセプトをまとめます。
- L1 には L0 に基づいて、具体的な実装仕様書をまとめます。
- ドキュメントのレイヤを必ず守ってください。
- 謝ったレイヤーにドキュメントを配置しないこと。

### GitHub操作

**すべてのGitHub操作（Issue作成、ブランチ作成、プルリクエスト作成など）は、git または  gh を通じて行います。** 明示的に示されていない限り開発者が直接Web UIやGitコマンドで操作することは原則として禁止します。 これにより、開発プロセスの一貫性と自動化を担保します。

- `gh issue create` / `gh pr create` の本文は `\n` では改行されません。
- 改行が必要な場合は `--body-file -` で標準入力を使用します。

### コード規約
- Python は [PER8](https://peps.python.org/pep-0008/)に準拠します
- JavaScript は [Google JavaScript Style Guide](https://google.github.io/styleguide/jsguide.html) に準拠します

## 2. 開発ワークフロー

まず初めに、このリポジトリのコンテキストを理解してください。
事前の知識を前提とせず、以下の手順で情報を収集します。

1.  **メインREADMEの読み取り:** `README.md`を読み、プロジェクトの概要を把握します。
2.  **ドキュメントの読み取り:** `docs/L0_phylosophy/`, `docs/L1_specification/` ディレクトリ内にあるすべてのファイルを読み、プロジェクトの詳細なドキュメントとアーキテクチャを理解します。
3.  **リポジトリの特定:** `.git/config` ファイルを読み、リモートリポジトリのURLを特定します。

当プロジェクトの開発は、すべてGitHub Issueを起点として進行します。**プロジェクトの初期セットアップや構成変更など、コード変更を伴ういかなる作業も、必ずIssueを作成してから開始してください。**これにより、タスクの明確化、進捗の可視化、そして成果物のトレーサビリティを確保します。

### Step 1: 作業対象 Issue の決定

Open Issue を一覧(issue #, title)で出力し、どの Issue の実装を開始するのか質問します。
ユーザーから指定されたら Issue の内容を確認します。

ユーザーから Issue 指定以外の指示があった場合にはそちらを優先します。

### Step 2: ブランチの作成
作業をする Issue が確定したら、その Issue に対応する作業ブランチを作成します。

- **ブランチ命名規則:** `feature/<issue番号>_<issue title>`
- **例:** Issue番号が`#10`でissueタイトルが`hogehoge`の場合、ブランチ名は `feature/10_hogehoge` となります。

### Step 3: タスクの実行

作成したブランチ上で、Issueに記されたタスクを順番に実行していきます。

**重要**
Issue に記されていないタスクが発生した場合には必ず Issue 本文のタスクリストに追加をしてから作業を進め、終了したタスクにはチェックを入れます。
これは、どんなタスクが残っていてどこまで作業が進んでいて次に何をするべきか？を明確にするためにとても重要なプロセスです。

また、調査タスクを実行した場合にはその調査結果を Issue に追加します

### Step 4: コミット
論理的な単位でのタスクが終わるごとに作業ブランチに対して **コミット** をし、作業上の留意点や気づきがあればその内容を詳しく Issue に記載します。
コミットメッセージは、1行目に `Phase #<Phase番号> [TASK] <タスク名>` を記し、空行を挟んで3行目以降に具体的な作業内容を箇条書きします。
全てのタスクが完了したら、ユーザーにローカルでの実行テストを促してください。

### Step 5: ドキュメントの更新とプルリクエストの作成

ユーザーからの実行テスト完了報告を受けたら以下の手順で作業を進めてください。

1. **README.md** や **docs/** 内のドキュメント一式を実装に合わせてアップデートが必要な場合は、

    - アップデート対象のドキュメント
    - アップデートの内容
    - アップデートが必要な理由

をユーザーに提示し、ドキュメントアップデートの可否の確認を行います。

2. アップデートする旨の指示があれば、Issue に新たな Phase のタスクとして追加して作業を実行します。
ドキュメントのアップデートが完了したらブランチに **コミット** します。コミットメッセージは Step3 で示した内容に準じます。
3. 作業ブランチをリモートリポジトリへ **push** します
4. リモートリポジトリへの push が成功したら **dev** ブランチに対してプルリクエストを作成します

プルリクエストは、

- **タイトル:** `[#<issue番号>] <Issueのタイトル>` の形式で記述します。
- **本文:**
    - `Closes #<issue番号>` を記載し、マージ時に自動でIssueが閉じるように設定します。
    - 実装内容の概要、経緯、実装上の留意点、レビューしてほしい点を英語で記述します。

また、プルリクエスト本文には issue のタグによって以下内容を記述します。

`enhancement` タグの issue に対しては、

- **実装のポイント:** 実装上のポイントを記載します
- **実装時の注意点:** 実装上困ったこと、それの解決、回避法を記載します
- **その他留意事項:** その他注意点などがあれば記載します

を、 `bug` タグの issue に対しては、

- **バグの原因:** バグが発生していた原因を記載します
- **修正内容:** 具体的にどのような対応をしたのか記載します

を、 `refactor` タグの issue に対しては、

- **リファクタリング前の状態:** リファクタリング前の状態について記載します
- **リファクタリング後の状態:** リファクタリング後の状態について記載します

を全て英語で**追記**してください。

### Step 6: コードレビューとマージ

作成されたプルリクエストは、チームメンバーによるコードレビューを受けます。
レビューでの指摘事項を修正し、承認（Approve）されたら、プルリクエストをマージします。

## 4. コミットメッセージの規約

コミットメッセージは [Conventional Commits](https://www.conventionalcommits.org/) の規約に従い全て英語で表記します

