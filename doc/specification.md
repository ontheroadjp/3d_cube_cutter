# 立体切断シミュレーター 仕様書 v0.4

## 1. プロジェクト概要
本プロジェクトは、中学受験算数の重要かつ難関単元である「立体切断（立方体・直方体の切断）」を、Webブラウザ上で直感的に学習できるシミュレーターです。
生徒自身が切断点を選び、どのように立体が切断されるか、切断面がどのような形になるか、切り取られた後の形がどうなるかを動的に確認することで、空間認識能力の向上を支援します。

## 2. ターゲットユーザー
*   **メインユーザー:** 中学受験を目指す小学生（4年生〜6年生）
*   **サブユーザー:** 保護者、塾の講師（解説ツールとして利用）

## 3. 主要機能

### 3.1. 操作モード
画面左上のセレクターで、以下の3つの操作モードを切り替えることができます。
*   **自由選択モード:** ユーザーが3Dモデル上で点を自由に選択して切断する基本モードです。
*   **プリセットモード:** よく出題される典型的な切断パターンを一覧から選択して表示するモードです。
*   **設定:** ラベルの表示/非表示や、立体図形のサイズなどを変更するモードです。

### 3.2. 自由選択モードでの操作
*   **切断点の選択:** 立体の頂点、または辺の上でクリックすることで、切断点（最大3点）を指定します。
*   **スナップとハイライト:**
    *   マウスを辺や頂点に合わせると、選択可能なスナップ点（頂点、辺の中点、辺上の1cm単位の点）がハイライト表示されます。
*   **マーカーの色:**
    *   選択された点が辺の**中点**である場合、マーカーは**緑色**で表示されます。それ以外の点は**赤色**で表示されます。
*   **辺分割のプレビュー:**
    *   辺の上にマウスを置くと、その点で切断した場合の分割後の辺の長さがリアルタイムでプレビュー表示されます。
*   **点の確定と切断:**
    *   3点目が選択された時点で自動的に切断が実行されます。
    *   3点が同一直線上に並ぶような点は選択できません。

### 3.3. プリセットモードでの操作
*   **カテゴリ選択:** 「三角形」「四角形」「多角形」のいずれかのカテゴリを選択します。
*   **プリセット選択:** 選択したカテゴリに属する典型パターンのボタン（例：「正六角形」）が表示されるので、それをクリックします。
*   **自動切断とカメラワーク:** プリセットを選択すると、対応する切断が実行され、切断面が見やすい角度にカメラが自動で移動します。

### 3.4. 設定モードでの操作
*   **設定項目の選択:** 「表示設定」または「立体図形の設定」を選択します。
*   **表示設定:**
    *   頂点ラベル(A-H)、面ラベル(Front, Back等)、辺の長さ、切断面、切り取られた部分の表示/非表示を切り替えられます。
    *   直方体の半透明化をON/OFFできます。
*   **立体図形の設定:**
    *   ボタンをクリックすると、幅・奥行き・高さを個別に入力でき、立体図形を再作成します。

### 3.5. 共通機能
*   **視点操作:** マウスドラッグによる回転、ホイールによるズーム、右クリックによる平行移動が可能です。
*   **切り取り反転:** 「切り取り反転」ボタンで、切り落とす側（大きい方／小さい方）を反転させることができます。
*   **展開図:** 「展開図」ボタンで、切断された立体の展開図と、そこに描画された切断線を別ウィンドウで表示できます。
*   **リセット:** 「リセット」ボタンで、全ての状態（切断状態、カメラの位置、UIモード）が初期状態に戻ります。

## 4. 技術スタック
*   **言語:** JavaScript (ES Modules)
*   **UIフレームワーク:** Bootstrap
*   **3Dライブラリ:**
    *   **Three.js:** 3D描画エンジン
    *   **three-bvh-csg:** 複雑な立体演算（Constructive Solid Geometry）に使用。
    *   **three-mesh-bvh:** 高速なRaycast（当たり判定）のために使用。
*   **動作環境:** モダンブラウザ（Chrome, Safari, Edge, Firefox）

## 5. 今後の拡張予定
*   **問題モード:** 「点I, J, Kを通る平面で切った時の切り口の形は？」などのクイズ機能。
*   **断面の形状判定:** 「三角形」「五角形」などの形状名を判定・表示。
*   **求積支援:** 切断後の立体の体積や表面積を表示、または計算過程の解説。
