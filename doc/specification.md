# 立体切断シミュレーター 仕様書

## 1. プロジェクト概要
本プロジェクトは、中学受験算数の重要かつ難関単元である「立体切断（立方体・直方体の切断）」を、Webブラウザ上で直感的に学習できるシミュレーターです。
生徒自身が切断点を選び、どのように立体が切断されるか、切断面がどのような形になるか、切り取られた後の形がどうなるかを動的に確認することで、空間認識能力の向上を支援します。

## 2. ターゲットユーザー
*   **メインユーザー:** 中学受験を目指す小学生（4年生〜6年生）
*   **サブユーザー:** 保護者、塾の講師（解説ツールとして利用）

## 3. 主要機能

### 3.1. 直方体の表示・設定
*   **初期表示:** 10cm × 10cm × 10cm の立方体を表示。
*   **サイズ変更:** ユーザーは「立体図形の設定」から、幅・高さ・奥行きの長さを自由に設定可能（例: 6cm × 10cm × 8cm など）。
*   **視点操作:** マウスドラッグによる回転、ホイールによるズーム、右クリックによる平行移動が可能。
*   **表示モード:** 正投影（パースペクティブなし）を採用し、問題用紙上の図形に近い見た目を提供。

### 3.2. 切断点の選択
*   **選択方法:** 立体の辺をクリックすることで、切断点（最大3点）を指定。
*   **スナップ機能:** クリックした位置に最も近い辺上の点に自動的に吸着。
*   **ラベル:**
    *   頂点: A, B, C... H
    *   切断点: I, J, K
*   **情報の可視化:** 選択された点から各頂点までの距離などを計算・表示（現在はポップアップ等で対応）。

### 3.3. 切断シミュレーション
*   **切断実行:** 3点目が選択された時点で自動的に切断を実行。
*   **切断面の描画:** 
    *   3点を通る平面で切断された断面を赤色（半透明）で表示。
    *   断面の輪郭を赤線で強調。
*   **切り取られた部分（三角錐）の表示:** 
    *   3点が1つの角（頂点）を共有する場合、切り落とされる「角」の部分（三角錐）を可視化。
    *   直方体の形状自体を切断後の形（CSG演算による変形）に更新。

### 3.4. 表示制御（UI）
以下の要素の表示/非表示をチェックボックスやセレクトボックスで切り替え可能。
*   **頂点ラベル:** A〜Hのアルファベット。
*   **辺の長さ:**
    *   表示しない
    *   常時表示
    *   **ポップアップ表示:** マウスオーバー時のみ、その辺（または分割された区間）の長さを表示。
*   **切断面:** 赤色の断面および輪郭線。
*   **切り取られた部分:** 切除された三角錐部分の表示。
*   **直方体の半透明化:** 内部構造（切断面の奥側など）を見やすくするため、直方体を半透明にする機能。

## 4. 技術スタック
*   **言語:** JavaScript (ES Modules)
*   **ライブラリ:**
    *   **Three.js:** 3D描画エンジン
    *   **three-bvh-csg:** 複雑な立体演算（Constructive Solid Geometry）に使用。直方体から三角錐を引き算する処理などに利用。
*   **動作環境:** モダンブラウザ（Chrome, Safari, Edge, Firefox）

## 5. 今後の拡張予定
*   **展開図機能:** 切断された立体の展開図を自動生成・表示。
*   **問題モード:** 「点I, J, Kを通る平面で切った時の切り口の形は？」などのクイズ機能。
*   **断面の形状判定:** 「三角形」「五角形」などの形状名を判定・表示。
*   **求積支援:** 切断後の立体の体積や表面積を表示、または計算過程の解説。
