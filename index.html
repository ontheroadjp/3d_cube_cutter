<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>立体切断シミュレーター v0.3</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body { margin:0; width:100%; height:100%; overflow:hidden; }
#ui-container {
    position: absolute; top: 0; left: 0; width: 100%; z-index: 100;
}
#tooltip { position:absolute; display:none; background:rgba(0,0,0,0.7); color:white; padding:4px 8px; border-radius:4px; pointer-events:none; z-index:1020; }
</style>
</head>
<body>

<div id="ui-container">
  <!-- Navbar: Simplified to only show title and selection count -->
  <nav class="navbar navbar-light bg-light shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">立体切断シミュレーター</a>
      <span class="navbar-text ms-auto">
        選択: <span id="count" class="badge bg-secondary">0</span> / 3
      </span>
    </div>
  </nav>

  <!-- Main Control Bar -->
  <div id="preset-bar" class="container-fluid py-2 bg-white bg-opacity-75 border-bottom">
    <div class="d-flex flex-wrap gap-2 align-items-center">
  
      <!-- Primary Mode Selector -->
      <select id="mode-selector" class="form-select form-select-sm" style="width: auto;">
        <option value="free">自由選択モード</option>
        <option value="preset">プリセットモード</option>
        <option value="settings">設定</option>
      </select>
  
      <!-- Preset Mode Controls (initially hidden) -->
      <div id="preset-controls" class="d-flex flex-wrap gap-2 align-items-center d-none">
        <select id="preset-category-filter" class="form-select form-select-sm" style="width: auto;">
          <option value="triangle" selected>三角形</option>
          <option value="quad">四角形</option>
          <option value="poly">多角形</option>
        </select>
        <div id="react-preset-root" class="d-flex flex-wrap gap-2"></div>
        <div id="presetButtons" class="d-flex flex-wrap gap-2">
          <!-- Preset buttons are dynamically added here -->
        </div>
      </div>

      <!-- Settings Mode Controls (initially hidden) -->
      <div id="settings-controls" class="d-flex flex-wrap gap-2 align-items-center d-none">
        <select id="settings-category-selector" class="form-select form-select-sm" style="width: auto;">
          <option value="display" selected>表示設定</option>
          <option value="cuboid">立体図形の設定</option>
          <option value="user-presets">ユーザープリセット</option>
        </select>
      </div>
  
      <!-- Right-aligned buttons -->
      <div class="ms-auto d-flex gap-2">
         <button id="flipCut" class="btn btn-warning btn-sm">切り取り反転</button>
         <button id="toggleNet" class="btn btn-primary btn-sm">展開図</button>
         <button id="reset" class="btn btn-outline-danger btn-sm">リセット</button>
      </div>
      
    </div>
  </div>

  <!-- Settings Panels (relocated from old menu, initially hidden) -->
  <div id="settings-panels" class="container-fluid p-3 bg-light border-bottom shadow-sm d-none">
    
    <div id="react-settings-root"></div>

    <!-- Display Settings Panel -->
    <div id="display-settings-panel">
        <h6 class="border-bottom pb-2 mb-3">表示設定</h6>
        <div class="row">
            <div class="col-6 col-md-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="toggleVertexLabels" checked>
                  <label class="form-check-label" for="toggleVertexLabels">頂点ラベル</label>
                </div>
                <div class="mt-2">
                  <button id="configureVertexLabels" class="btn btn-outline-secondary btn-sm">頂点ラベルを設定...</button>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="toggleCutSurface" checked>
                  <label class="form-check-label" for="toggleCutSurface">切断面</label>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="togglePyramid">
                  <label class="form-check-label" for="togglePyramid">切り取られた部分</label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="toggleCubeTransparency" checked>
                  <label class="form-check-label" for="toggleCubeTransparency">直方体を半透明</label>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="toggleFaceLabels" checked>
                  <label class="form-check-label" for="toggleFaceLabels">面ラベル</label>
                </div>
                <div class="mt-2">
                  <label class="form-label text-muted small mb-1">辺の長さ</label>
                  <select id="edgeLabelMode" class="form-select form-select-sm w-auto d-inline-block">
                    <option value="visible">表示する</option>
                    <option value="popup">ポップアップ</option>
                    <option value="hidden">表示しない</option>
                  </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Cuboid Settings Panel (initially hidden) -->
    <div id="cuboid-settings-panel" class="d-none">
        <div id="react-cuboid-root"></div>
    </div>

    <!-- User Presets Panel (initially hidden) -->
    <div id="user-presets-panel" class="d-none">
        <div id="react-user-presets-root"></div>
    </div>
  </div>

</div>

<div id="react-root"></div>

<div id="alert-container" style="position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 2000; width: 80%; max-width: 600px;"></div>
<div id="tooltip"></div>

<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="importmap">
  {
    "imports": {
      "three": "./lib/three/build/three.module.js",
      "three/addons/": "./lib/three/examples/jsm/",
      "three-mesh-bvh": "https://unpkg.com/three-mesh-bvh@0.7.3/build/index.module.js",
      "three-bvh-csg": "https://unpkg.com/three-bvh-csg@0.0.16/build/index.module.js",
      "react": "https://esm.sh/react@18",
      "react-dom/client": "https://esm.sh/react-dom@18/client"
    }
  }
</script>
<script type="module" src="./dist/main.js"></script>
</body>
</html>
