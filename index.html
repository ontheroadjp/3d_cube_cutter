<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>立体切断シミュレーター v0.2</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body { margin:0; width:100%; height:100%; overflow:hidden; }
/* Custom overrides */
.navbar { background-color: rgba(255, 255, 255, 0.95) !important; backdrop-filter: blur(5px); }
#ui-container {
    position: absolute; top: 0; left: 0; width: 100%; z-index: 100;
}
#tooltip { position:absolute; display:none; background:rgba(0,0,0,0.7); color:white; padding:4px 8px; border-radius:4px; pointer-events:none; z-index:1020; }
</style>
</head>
<body>

<div id="ui-container">
  <nav class="navbar navbar-light bg-light shadow-sm">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation" id="menu-toggle">
        <span class="navbar-toggler-icon"></span>
        <span class="ms-2">メニュー / 設定</span>
      </button>
      <span class="navbar-text ms-auto">
        選択: <span id="count" class="badge bg-secondary">0</span> / 3
      </span>
    </div>
  </nav>

  <!-- Always Visible Preset Bar -->
  <div id="preset-bar" class="container-fluid py-2 bg-white bg-opacity-75 border-bottom">
    <div class="d-flex flex-wrap gap-2 align-items-center">
      <span class="small fw-bold text-muted me-2">パターン:</span>
      <button data-preset="free" class="btn btn-secondary btn-sm fw-bold">自由選択</button>
      <div id="presetButtons" class="d-flex flex-wrap gap-2">
        <!-- 典型パターンボタンは動的に追加される -->
      </div>
      <div class="ms-auto">
         <button id="flipCut" class="btn btn-warning btn-sm">切り取り反転</button>
      </div>
    </div>
  </div>
  
  <div class="collapse" id="navbarToggleExternalContent">
    <div class="bg-light p-4 shadow-sm" id="ui-panel">
      <div class="container-fluid">
        <div class="row g-3">
          <!-- Basic Controls -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2">基本操作 & 表示設定</h6>
            <div class="d-flex gap-2 mb-3">
              <button id="reset" class="btn btn-outline-danger btn-sm">リセット</button>
              <button id="configure" class="btn btn-outline-primary btn-sm">立体図形の設定</button>
              <button id="toggleNet" class="btn btn-primary btn-sm">展開図を表示</button>
            </div>
            
            <div class="row">
                <div class="col-6">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="toggleVertexLabels" checked>
                      <label class="form-check-label" for="toggleVertexLabels">頂点ラベル</label>
                    </div>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="toggleCutSurface" checked>
                      <label class="form-check-label" for="toggleCutSurface">切断面</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="togglePyramid">
                      <label class="form-check-label" for="togglePyramid">切り取られた部分</label>
                    </div>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="toggleCubeTransparency" checked>
                      <label class="form-check-label" for="toggleCubeTransparency">直方体を半透明</label>
                    </div>
                </div>
            </div>
            <div class="mt-2">
              <label class="form-label text-muted small mb-1">辺の長さ</label>
              <select id="edgeLabelMode" class="form-select form-select-sm w-auto d-inline-block">
                <option value="visible">表示する</option>
                <option value="popup">ポップアップ</option>
                <option value="hidden">表示しない</option>
              </select>
            </div>
          </div>
          
          <div class="col-12 mt-3 text-muted small">
             <div id="edgeLengths"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="alert-container" style="position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 2000; width: 80%; max-width: 600px;"></div>
<div id="tooltip"></div>

<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="importmap">
  {
    "imports": {
      "three": "./lib/three/build/three.module.js",
      "three-mesh-bvh": "https://unpkg.com/three-mesh-bvh@0.7.3/build/index.module.js",
      "three-bvh-csg": "https://unpkg.com/three-bvh-csg@0.0.16/build/index.module.js"
    }
  }
</script>
<script type="module" src="./main.js"></script>
</body>
</html>
